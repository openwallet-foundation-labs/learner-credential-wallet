appId: ${APP_ID}
env:
  BADGE_FILE_NAME: "certified-safe-4-agilist.png"

  CREDENTIAL_JSON: |-
    {
      "@context": [
          "https://www.w3.org/2018/credentials/v1",
          "https://purl.imsglobal.org/spec/ob/v3p0/context-3.0.3.json",
          "https://w3id.org/security/data-integrity/v2",
          "https://w3id.org/security/suites/ed25519-2020/v1"
      ],
      "id": "urn:uuid:2fe53dc9-b2ec-4939-9b2c-0d00f6663b6c",
      "issuanceDate": "2025-01-09T15:06:31Z",
      "type": [
          "VerifiableCredential",
          "OpenBadgeCredential"
      ],
      "name": "DCC Test Credential",
      "issuer": {
          "type": [
              "Profile"
          ],
          "id": "did:key:z6MkuL7x2mTEoBmUuuaQ2hvEUd2YsEtmsHeX9JzqJZ8VYaVH",
          "name": "Digital Credentials Consortium Test Issuer",
          "url": "https://dcconsortium.org",
          "image": "https://user-images.githubusercontent.com/752326/230469660-8f80d264-eccf-4edd-8e50-ea634d407778.png"
      },
      "credentialSubject": {
          "type": [
              "AchievementSubject"
          ],
          "achievement": {
              "id": "urn:uuid:bd6d9316-f7ae-4073-a1e5-2f7f5bd22922",
              "type": [
                  "Achievement"
              ],
              "achievementType": "Diploma",
              "name": "Badge",
              "description": "This is a sample credential issued by the Digital Credentials Consortium to demonstrate the functionality of Verifiable Credentials for wallets and verifiers.",
              "criteria": {
                  "type": "Criteria",
                  "narrative": "This credential was issued to a student that demonstrated proficiency in the Python programming language that occurred from **February 17, 2023** to **June 12, 2023**."
              },
              "image": {
                  "id": "https://user-images.githubusercontent.com/752326/214947713-15826a3a-b5ac-4fba-8d4a-884b60cb7157.png",
                  "type": "Image"
              }
          },
          "name": "Jane Doe"
      },
      "proof": [
          {
              "type": "DataIntegrityProof",
              "created": "2025-05-09T19:02:33Z",
              "verificationMethod": "did:key:z6MkuL7x2mTEoBmUuuaQ2hvEUd2YsEtmsHeX9JzqJZ8VYaVH#z6MkuL7x2mTEoBmUuuaQ2hvEUd2YsEtmsHeX9JzqJZ8VYaVH",
              "cryptosuite": "eddsa-rdfc-2022",
              "proofPurpose": "assertionMethod",
              "proofValue": "z2YEmAhbPqipyhJatMCWibQqEmoE9ViDm6HUU64pub8jmMiyL9VmNL7SDVUZXoBAa6aksG6iLmF7yt14tQXU4VJ6H"
          },
          {
              "type": "Ed25519Signature2020",
              "created": "2025-05-09T19:02:33Z",
              "verificationMethod": "did:key:z6MkuL7x2mTEoBmUuuaQ2hvEUd2YsEtmsHeX9JzqJZ8VYaVH#z6MkuL7x2mTEoBmUuuaQ2hvEUd2YsEtmsHeX9JzqJZ8VYaVH",
              "proofPurpose": "assertionMethod",
              "proofValue": "z22ELGnLk8f1KKH9WA7mkw3X65iEH6d6F413u1DStC7Vc4neZsHTWmiRti54bKz6HRXzqnaRBfApPZctQn7c3Ht2U"
          }
      ]
    }
  CREDENTIAL_URL: "https://digitalcredentials.github.io/vc-test-fixtures/verifiableCredentials/v1/bothSignatureTypes/didKey/fourRegistry-noStatus-noExpiry.json"
  
  CREDENTIAL_JSON_1: |-
    {
      "@context": [
        "https://www.w3.org/2018/credentials/v1",
        "https://purl.imsglobal.org/spec/ob/v3p0/context-3.0.3.json",
        "https://w3id.org/security/data-integrity/v2",
        "https://w3id.org/security/suites/ed25519-2020/v1"
      ],
      "id": "urn:uuid:2fe53dc9-b2ec-4939-9b2c-0d00f6663b6c",
      "issuanceDate": "2025-01-09T15:06:31Z",
      "type": [
        "VerifiableCredential",
        "OpenBadgeCredential"
      ],
      "name": "DCC Test Credential",
      "issuer": {
        "type": [
          "Profile"
        ],
        "id": "did:key:z6MkqBcwQ7qnRBRpgtsJQviLFeYxExMUE2k9nwKkMTF3DdRZ",
        "name": "Digital Credentials Consortium Test Issuer",
        "url": "https://dcconsortium.org",
        "image": "https://user-images.githubusercontent.com/752326/230469660-8f80d264-eccf-4edd-8e50-ea634d407778.png"
      },
      "credentialSubject": {
        "type": [
          "AchievementSubject"
        ],
        "achievement": {
          "id": "urn:uuid:bd6d9316-f7ae-4073-a1e5-2f7f5bd22922",
          "type": [
            "Achievement"
          ],
          "achievementType": "Diploma",
          "name": "Badge",
          "description": "This is a sample credential issued by the Digital Credentials Consortium to demonstrate the functionality of Verifiable Credentials for wallets and verifiers.",
          "criteria": {
            "type": "Criteria",
            "narrative": "This credential was issued to a student that demonstrated proficiency in the Python programming language that occurred from **February 17, 2023** to **June 12, 2023**."
          },
          "image": {
            "id": "https://user-images.githubusercontent.com/752326/214947713-15826a3a-b5ac-4fba-8d4a-884b60cb7157.png",
            "type": "Image"
          }
        },
        "name": "Jane Doe"
      },
      "proof": [
        {
          "type": "DataIntegrityProof",
          "created": "2025-05-12T15:19:58Z",
          "verificationMethod": "did:key:z6MkqBcwQ7qnRBRpgtsJQviLFeYxExMUE2k9nwKkMTF3DdRZ#z6MkqBcwQ7qnRBRpgtsJQviLFeYxExMUE2k9nwKkMTF3DdRZ",
          "cryptosuite": "eddsa-rdfc-2022",
          "proofPurpose": "assertionMethod",
          "proofValue": "z3aFbi5iYu1j7qiuSNvw2CEHNCJYj3TSmZVgoi8FzTktAeBMEDPK1r8zEyD2bKZjkFCqCKDGwWqPbBZe49okPFbKu"
        },
        {
          "type": "Ed25519Signature2020",
          "created": "2025-05-12T15:19:58Z",
          "verificationMethod": "did:key:z6MkqBcwQ7qnRBRpgtsJQviLFeYxExMUE2k9nwKkMTF3DdRZ#z6MkqBcwQ7qnRBRpgtsJQviLFeYxExMUE2k9nwKkMTF3DdRZ",
          "proofPurpose": "assertionMethod",
          "proofValue": "z5N1SMXdQkc6jZqsMXjY1vULqiQ1ETg1QuTj8D4DZyv5qwfWjPZPzRohGiWTyk75vfp4H6uaHst7J2LuHacTuc5nD"
        }
      ]
    }
  CREDENTIAL_URL_1: "https://digitalcredentials.github.io/vc-test-fixtures/verifiableCredentials/v1/bothSignatureTypes/didKey/oidf-noStatus-expired.json"

  CREDENTIAL_JSON_2: |-
    {
      "type": [
        "VerifiableCredential",
        "OpenBadgeCredential"
      ],
      "name": "Taylor Tuna - Mock Bachelor of Science Degree in Biology",
      "issuer": {
        "url": "https://web.mit.edu/",
        "type": "Profile",
        "name": "Massachusetts Institute of Technology",
        "image": {
          "id": "https://github.com/digitalcredentials/test-files/assets/206059/01eca9f5-a508-40ac-9dd5-c12d11308894",
          "type": "Image"
        },
        "id": "did:web:digitalcredentials.github.io:vc-test-fixtures:dids:legacy"
      },
      "@context": [
        "https://www.w3.org/2018/credentials/v1",
        "https://purl.imsglobal.org/spec/ob/v3p0/context-3.0.1.json",
        "https://www.w3.org/ns/credentials/status/v1",
        "https://w3id.org/security/suites/ed25519-2020/v1",
        "https://w3id.org/security/data-integrity/v2"
      ],
      "credentialSubject": {
        "type": [
          "AchievementSubject"
        ],
        "name": "Taylor Tuna",
        "achievement": {
          "id": "urn:uuid:951b475e-b795-43bc-ba8f-a2d01efd2eb1",
          "type": [
            "Achievement"
          ],
          "name": "Mock Bachelor of Science in Biology",
          "criteria": {
            "type": "Criteria",
            "narrative": "In Recognition of proficiency in the general and the special studies and exercises prescribed by said institution for such mock degree given this day under the seal of the Institute at Cambridge in the Commonwealth of Massachusetts"
          },
          "description": "Massachusetts Institute of Technology Mock Bachelor of Science in Computer Science",
          "fieldOfStudy": "Biology",
          "achievementType": "BachelorDegree"
        }
      },
      "id": "urn:uuid:677fe54fcacf98774d482bcc",
      "credentialStatus": {
        "id": "https://digitalcredentials.github.io/vc-test-fixtures/statusLists/didkey-ed25519Signature2020/e5WK8CbZ1GjycuPombrj#6",
        "type": "BitstringStatusListEntry",
        "statusPurpose": "revocation",
        "statusListCredential": "https://digitalcredentials.github.io/vc-test-fixtures/statusLists/didkey-ed25519Signature2020/e5WK8CbZ1GjycuPombrj",
        "statusListIndex": "6"
      },
      "issuanceDate": "2025-01-09T15:06:31Z",
      "proof": [
        {
          "type": "DataIntegrityProof",
          "created": "2025-05-08T19:12:47Z",
          "verificationMethod": "did:web:digitalcredentials.github.io:vc-test-fixtures:dids:legacy#z6MkjXe1vZvPRqFuc9nRBtZ3e1Y9XKDFSbjFAfzLfW2bD6cZ",
          "cryptosuite": "eddsa-rdfc-2022",
          "proofPurpose": "assertionMethod",
          "proofValue": "z3azZMeeKKZGkbWqkvrAoRrDFFkSpSCddi47zAakhNHCSq4CZ7f6n7EeKXY8bRgjgMvtHDsNgv9J4JPKS1pKtNsM6"
        },
        {
          "type": "Ed25519Signature2020",
          "created": "2025-05-08T19:12:47Z",
          "verificationMethod": "did:web:digitalcredentials.github.io:vc-test-fixtures:dids:legacy#z6MkjXe1vZvPRqFuc9nRBtZ3e1Y9XKDFSbjFAfzLfW2bD6cZ",
          "proofPurpose": "assertionMethod",
          "proofValue": "z4CGxNaM8tKj8yLRPckJhT7JcDxjCrsivDabCARRKNPDKQsBdiCeqqoeqYRQ3U1XzM2M3QY77FnZEoLFTZASLJERK"
        }
      ]
    }
  CREDENTIAL_URL_2: "https://digitalcredentials.github.io/vc-test-fixtures/verifiableCredentials/v1/bothSignatureTypes/didKey/oidf-revokedStatus-expired.json"
---

# Setup: Create fresh wallet
- runFlow:
    file: onboarding.yaml

# Verify empty wallet state
- extendedWaitUntil:
    visible: "Looks like your wallet is empty."
    timeout: 10000

- waitForAnimationToEnd

# Navigate to Add Credential (Verified credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

# Verify Add Credential screen loaded
- extendedWaitUntil:
    visible: "Paste JSON or URL"
    timeout: 8000

# Input credential data and submit
- tapOn:
    id: "paste-json-input"

- inputText: "${CREDENTIAL_JSON}"

- waitForAnimationToEnd

# Submit credential
- tapOn:
    id: "add-credential-button"

- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

# Wait for credential processing - handling both success and error cases
- waitForAnimationToEnd:
    timeout: 15000

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Done"

# Wait for navigation
- waitForAnimationToEnd

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000
    
# Test credential deletion functionality after credential is added
- waitForAnimationToEnd:
    timeout: 5000

- tapOn:
    id: "credential-card-item"

- waitForAnimationToEnd:
    timeout: 5000

# Check if we're on credential detail screen
- extendedWaitUntil:
    visible: "Credential Preview"
    timeout: 5000
    optional: true

- tapOn:
    id: "credential-menu-button"

- waitForAnimationToEnd:
    timeout: 5000

- extendedWaitUntil:
    visible: "credential-delete-button"
    timeout: 5000
    optional: true

- tapOn:
    id: "credential-delete-button"

- waitForAnimationToEnd:
    timeout: 5000

- tapOn:
    text: "Delete"

- waitForAnimationToEnd

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Add second credential via URL (Verified credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

# Use URL input to add credential via URL
- tapOn:
    id: "paste-json-input"

- inputText:
    text: "${CREDENTIAL_URL}"

- waitForAnimationToEnd

# Submit URL credential
- tapOn:
    id: "add-credential-button"

# Accept second credential with error handling
- waitForAnimationToEnd:
    timeout: 15000
    
- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

- tapOn:
    text: "Accept"
    optional: true

# Handle errors or alternative flows
- tapOn:
    text: "Close"
    optional: true

- tapOn:
    text: "Done"

# Wait for navigation
- waitForAnimationToEnd

- waitForAnimationToEnd:
    timeout: 3000

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000
    
# Navigate to Add Credential (Warning Credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

# Verify Add Credential screen loaded
- extendedWaitUntil:
    visible: "Paste JSON or URL"
    timeout: 8000

# Input credential data and submit
- tapOn:
    id: "paste-json-input"

- inputText: "${CREDENTIAL_JSON_1}"

- waitForAnimationToEnd

# Submit credential
- tapOn:
    id: "add-credential-button"

- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

# Wait for credential processing - handle both success and error cases
- waitForAnimationToEnd:
    timeout: 15000

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Done"

# Wait for navigation
- waitForAnimationToEnd

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Add credential via URL (Warning Credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

- tapOn:
    id: "paste-json-input"

- inputText:
    text: "${CREDENTIAL_URL_1}"

- waitForAnimationToEnd

- tapOn:
    id: "add-credential-button"

- waitForAnimationToEnd:
    timeout: 15000
    
- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Close"
    optional: true

- tapOn:
    text: "Done"

# Wait for navigation
- waitForAnimationToEnd

- waitForAnimationToEnd:
    timeout: 3000

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Navigate to Add Credential (Not verified credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

# Verify Add Credential screen loaded
- extendedWaitUntil:
    visible: "Paste JSON or URL"
    timeout: 8000

# Input credential data and submit
- tapOn:
    id: "paste-json-input"

- inputText: "${CREDENTIAL_JSON_2}"

- waitForAnimationToEnd

# Submit credential
- tapOn:
    id: "add-credential-button"

- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

- waitForAnimationToEnd:
    timeout: 15000

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Done"

- waitForAnimationToEnd

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Add credential via URL (Not verified credential)
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

- tapOn:
    id: "paste-json-input"

- inputText:
    text: "${CREDENTIAL_URL_2}"

- waitForAnimationToEnd

- tapOn:
    id: "add-credential-button"

- waitForAnimationToEnd:
    timeout: 15000
    
- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Close"
    optional: true

- tapOn:
    text: "Done"

- waitForAnimationToEnd

- waitForAnimationToEnd:
    timeout: 3000

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Try to add already existing credential
- tapOn:
    text: "Add Credential"

- waitForAnimationToEnd

- tapOn:
    id: "paste-json-input"

- inputText:
    text: "${CREDENTIAL_URL_2}"

- waitForAnimationToEnd

- tapOn:
    id: "add-credential-button"

- waitForAnimationToEnd:
    timeout: 15000
    
- extendedWaitUntil:
    visible: "Accept"
    timeout: 20000
    optional: true

- tapOn:
    text: "Accept"
    optional: true

- tapOn:
    text: "Close"
    optional: true

- tapOn:
    text: "Done"
    optional: true

- waitForAnimationToEnd

- waitForAnimationToEnd:
    timeout: 3000

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000

# Test credential sharing functionality
- waitForAnimationToEnd:
    timeout: 5000

- tapOn:
    id: "credential-card-item"

- waitForAnimationToEnd:
    timeout: 5000

# Navigate to share screen via menu
- tapOn:
    id: "credential-menu-button"

- waitForAnimationToEnd:
    timeout: 3000

- extendedWaitUntil:
    visible: "credential-share-button"
    timeout: 5000
    optional: true

- tapOn:
    id: "credential-share-button"
    optional: true

- tapOn:
    text: "Share"
    optional: true

- waitForAnimationToEnd:
    timeout: 5000

- extendedWaitUntil:
    visible:
      id: "create-public-link-button"
    timeout: 10000

- tapOn:
    id: "create-public-link-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    text: "Create Link"

- waitForAnimationToEnd:
    timeout: 10000

# Test copy link
- tapOn:
    id: "copy-link-button"

- waitForAnimationToEnd:
    timeout: 3000

# Test view link
- tapOn:
    id: "view-link-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    point: "3%,3%"

- waitForAnimationToEnd:
    timeout: 1000

- waitForAnimationToEnd

# Test LinkedIn sharing
- tapOn:
    id: "linkedin-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    text: "Add to LinkedIn"

- waitForAnimationToEnd:
    timeout: 5000

- tapOn:
    point: "3%,3%"

- waitForAnimationToEnd

# Test send credential
- tapOn:
    id: "send-credential-button"

- waitForAnimationToEnd:
    timeout: 10000

- tapOn:
    point: "30%,30%"

- waitForAnimationToEnd:
    timeout: 3000

# Test unshare functionality
- tapOn:
    id: "unshare-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    text: "Unshare Link"

- waitForAnimationToEnd

- tapOn:
    id: "linkedin-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    text: "Add to LinkedIn"

- waitForAnimationToEnd:
    timeout: 5000

- tapOn:
    point: "3%,3%"

- waitForAnimationToEnd

- tapOn:
    id: "send-credential-button"

- waitForAnimationToEnd:
    timeout: 10000

- tapOn:
    point: "30%,30%"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    id: "unshare-button"

- waitForAnimationToEnd:
    timeout: 3000

- tapOn:
    text: "Unshare Link"

# Navigate back to home
- tapOn:
    point: "10%,10%"

- extendedWaitUntil:
    visible: "Home Screen"
    timeout: 10000