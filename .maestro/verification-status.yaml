appId: ${APP_ID}
env:
  PASSWORD: "TestPassword123!"
---

- runFlow:
    file: credential-management.yaml

# Navigate to credential detail
- tapOn:
    id: "credential-card-item"

- scrollUntilVisible:
    element:
      text: "Credential Verification and Validation"
    direction: DOWN

# Verify verification status section is visible
- assertVisible:
    text: "Credential Verification and Validation"

# Wait for verification to complete
- extendedWaitUntil:
    visible:
      text: ".*signature.*"
    timeout: 90000
    optional: true

# If verification completed, check results
- runFlow:
    when:
      visible: ".*valid signature.*"
    commands:
      - assertVisible:
          text: ".*valid signature.*"
      - assertVisible:
          text: ".*not expired.*|.*no expiration.*"
      - assertVisible:
          text: ".*not been revoked.*"

# Check if credential has invalid signature
- runFlow:
    when:
      visible: ".*invalid signature.*"
    commands:
      - assertVisible:
          text: ".*invalid signature.*"

# If verification is still loading, scroll to check loading state is visible
- runFlow:
    when:
      visible: "Verifying credential..."
    commands:
      - assertVisible: "Verifying credential..."

# If verification completed, verify the fields exist
- runFlow:
    when:
      visible: ".*signature.*"
    commands:
      - assertVisible:
          text: ".*signature.*"
      - assertVisible:
          text: ".*(expired|expiration).*"
      - assertVisible:
          text: ".*revoked.*"
      - scroll
      - assertVisible:
          text: ".*Last Checked.*"

- waitForAnimationToEnd
