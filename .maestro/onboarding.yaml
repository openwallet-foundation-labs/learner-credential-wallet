appId: ${APP_ID}
env:
  PASSWORD: "TestPassword123!"
---
- clearState

# Connect to Metro via deep link (bypasses dev client UI, works on local + CI)
- openLink: "exp+learner-credential-wallet://expo-development-client/?url=http%3A%2F%2Flocalhost%3A8081"

# Dismiss Expo dev client intro if it appears (local shows it, CI may skip it)
- runFlow:
    when:
      visible: "Continue"
    commands:
      - tapOn:
          text: "Continue"
      - waitForAnimationToEnd:
          timeout: 3000

# Dismiss Expo dev menu overlay if it appears (swipe down to close bottom sheet)
- runFlow:
    when:
      visible: "Go home"
    commands:
      - swipe:
          direction: DOWN
          duration: 400
      - waitForAnimationToEnd:
          timeout: 3000

- extendedWaitUntil:
    visible: "Quick Setup"
    timeout: 120000

- assertVisible: "Quick Setup"

- tapOn: "Quick Setup"

- runFlow:
    when:
      visible: "Password"
    commands:
      - tapOn:
          id: "password-input"
      - waitForAnimationToEnd:
          timeout: 2000
      - inputText: "${PASSWORD}"
      - tapOn:
          id: "confirm-password-input"
      - waitForAnimationToEnd:
          timeout: 2000
      - inputText: "${PASSWORD}"
      - hideKeyboard
      - waitForAnimationToEnd:
          timeout: 2000
      - tapOn:
          id: "next-button"

- waitForAnimationToEnd:
    timeout: 15000

- extendedWaitUntil:
    visible: "Creating Wallet"
    timeout: 10000
    optional: true

- extendedWaitUntil:
    visible: "This will only take a moment."
    timeout: 10000
    optional: true

- extendedWaitUntil:
    visible: "Take Me To My Wallet"
    timeout: 15000
    optional: true
    
- tapOn: 
    text: "Take Me To My Wallet"
    optional: true

# Alternative completion methods
- tapOn:
    text: "Done"
    optional: true

- tapOn:
    text: "Continue"
    optional: true

- tapOn:
    text: "Get Started"
    optional: true

# Wait for wallet to be ready
- waitForAnimationToEnd:
    timeout: 5000
